# 자바(JVM)의 메모리 사용 방식

프로그램을 실행시킬 때 CPU와 작업을 위해 저장장치에 있던 내용들이 메모리에 올라간다. 메모리에 데이터들이 어떤 방식으로 올라가는지 알아보자.

Java에서 메모리는 크게 4가지 영역으로 나눌 수 있다. 코드 실행 영역, Static 영역, Stack 영역, Heap 영역이다.

![img](https://t1.daumcdn.net/cfile/tistory/9951443D5C6E85BE02)

### Static 영역

- 패키지나 클래스의 정보(메서드, 멤버 변수)가 올라간다.
- 패키지나 클래스는 프로그램 시작과 동시에 모두 올라가는 것이 아니라, 실제로 호출될 때 올라간다.
- static이라는 키워드를 붙여서 선언된 필드와 메소드인 '클래스 멤버'도 static 영역에 올라간다. static 영역에 있는 것은 어떤 곳에서나 접근이 가능하기 때문에 '전역'이라는 키워드를 사용한다.
- 그러므로, static 변수는 읽기 전용이 아닌 경우에는 사용하면 안 된다.
- class 영역 혹은 method 영역이라고 불린다.
- static 영역에 올라가면 JVM이 종료될 때까지 사라지지 않고, 유지된다.



### Stack 영역

- 여는 중괄호({)를 만날 때 마다 스택 프레임이 하나씩 생기고, 닫는 중괄호(})를 만나면 스택 프레임이 하나씩 사라진다. 그러므로 메서드가 실행될 뿐 만 아니라, if문, 반복문, 예외처리를 위한 try문 등도 모두 스택 프레임이 생기게 된다.
- stack 내부에서 선언된 지역 변수는 stack 영역에 올라간다.
- 기본형 타입 변수 값들은 stack 영역에 저장되고, 참조형 타입 변수는 참조값만 저장된다.(이 참조값은 heap 영역에 존재하는 인스턴스를 가리키는 역할을 한다)
- 외부 스택 프레임에서는 내부 스택 프레임의 변수에 접근하는 것이 불가능하나 그 반대는 가능하다. 메서드 안에 for문 스택 프레임을 만든 경우, for문에서는 메서드 변수를 사용할 수 있지만, 메서드에서는 for문의 변수를 사용할 수 없다.
- 쓰레드도 stack 영역에 생긴다. 하나의 쓰레드는 내부적으로 별개의 stack, static, heap 영역을 가진다. 이런 이유로 하나의 쓰레드는 다른 쓰레드로 접근할 수 없지만, static 영역과 heap 영역은 공유해서 사용할 수 있는 특징을 가진다.



### Heap 영역

- 생성된 객체(인스턴스)들이 올라간다.
- 인스턴스 필드들은 heap 영역에 올라간다.(이러한 이유로 static 메서드에서 인스턴스 멤버를 접근할 수가 없다. 어떤 인스턴스 인지 알 수 없고, 존재하지 않을 수 있기 때문이다.)
- stack영역에서 참조값을 이용하여 참조형 변수가 heap 영역에 있는 인스턴스를 가리키고 제어할 수 있다.
- 어떤 참조 변수도 힙 영역에 있는 인스턴스를 참조하지 않는다면, GC에 의해 메모리에서 사라진다.
- 상속을 이용한 인스턴스를 만든다면 상위 클래스들의 인스턴스도 같이 생성된다.
